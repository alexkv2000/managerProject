<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bin Storage List</title>
    <link rel="stylesheet" href="/jquery.dataTables.min.css">
    <link rel="stylesheet" href="/bootstrap.min.css">
    <link rel="stylesheet" href="/menu/menu.css">
</head>
<body class="min-vh-100">
<nav>
    <ul class="topmenu">
        <li><a href="/">Главная -</a></li>
        <li><a href="" class="down">Справочник -</a>
            <ul class="submenu">
                <li><a href="/entity">Юр. лица</a></li>
                <li><a href="/division">Отдел / подразделения</a></li>
                <li><a href="/employee">Сотрудники</a></li>
                <li><a href="/jobplace">Рабочие места</a></li>
                <li><a href="/stepproject">Этапы проекта</a></li>
            </ul>
        </li>
        <li><a href="" class="down">Проекты -</a>
            <ul class="submenu">
                <li><a href="/projectlist">Проекты</a></li>
                <li><a href="/planpayproject">План оплат проектов</a></li>
                <li><a href="/factpayment">Факт оплаты проектов</a></li>
                <li><a href="/binstorage">Хранилице файлов</a></li>
            </ul>
        </li>
        <li><a href="/schemadoc" class="down">Шаблоны -</a></li>
        <li><a href="/blog">Блог</a></li>
    </ul>
</nav>
<div class="container-fluid">
    <div class="row">
        <div class="col min-vh-100 py-3">
            <!--моя вставка-->
            <!--            <div class="container my-2" align="center">-->
            <div align="center">
                <h3>Список [хранилище файлов]</h3>
                <a th:href="@{/addbinstorage}" class="btn btn-primary btn-sm mb-3">Добавить файл</a>
                <table style="width:80%" border="1" class="table table-striped table-responsive-xxl">
                    <thead>
                    <tr>
                        <th>Наименование проекта</th>
                        <th>Этап проекта</th>
                        <!--                        <th>Название файла</th>-->
                        <th>Размер файла</th>
                        <th>Дата создания</th>
                        <th>Комментарий</th>
                        <th>Файл</th>
                        <th>Добавить файл</th>
                        <th>Редакция</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="binstorage:${binstorages}">
                        <td th:hidden="${binstorage.id}"></td>
                        <td th:text="${binstorage.projectsListByNameProject.name}"></td>
                        <td th:text="${binstorage.libStepProjectByStepProject.nameStepProject}"></td>
                        <!--                        &lt;!&ndash;                        <td th:text="${#dates.format(schemdoc.getDateCreate(), 'dd-MM-yyyy')}"></td>&ndash;&gt;-->
                        <!--                        <td th:text="${binstorage.nameFile}"></td>-->
                        <td th:text="${binstorage.dateCreate}"></td>
                        <td th:text="${#dates.format(binstorage.getDateCreate(), 'dd-MM-yyyy')}"></td>
                        <td th:text="${binstorage.comments}"></td>
                        <td>
                            <!--                            <li th:text="${file.getName()}" th:each="file:${fileData}"></li>-->
                            <ul>
                                <li th:each="file : ${fileData}"
                                    th:if="${file.getId_Data() == binstorage.getId()}">
                                    <a th:href="@{/download/{id}(id=${file.getId()})}"
                                       th:text="${file.getName()}" target="_blank"
                                       download="true">
                                    </a>
                                </li>
                            </ul>
                        </td>

                        <td>
                            <form action="/uploadbinstorage" method="post" enctype="multipart/form-data"
                                  id="uploadForm">
                                <div>
                                    <input type="hidden" name="binstorageId" th:value="${binstorage.id}"/>
<!--                                    <style>-->
<!--                                        .form-control {-->
<!--                                            bs-border-color: #0d6efd;-->
<!--                                            color: #0d6efd;-->
<!--                                        }-->
<!--                                    </style>-->
                                    <input class="form-control form-control-sm" type="file" name="file" id="fileInput" accept=".jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsm,.xlsx,.dot,.xlst,.txt,.srv,.reg,.pdf"
                                           onchange="this.form.submit();" style="bs-border-color:#0d6efd; color:#0d6efd;"/>
                                </div>
                            </form>
                        </td>
                        <script type="text/javascript">
                            document.getElementById("fileInput").addEventListener('change', function () {
                                const file = this.files[0];
                                const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif|\.pdf|\.doc|\.docx|\.xls.|\.xlsm|\.xlsx|\.dot|\.xlst|\.txt|\.srv|\.reg)$/i; // Задайте разрешенные типы файлов

                                if (file) {
                                    if (!allowedExtensions.exec(file.name)) {
                                        this.value = ''; // Отменяем выбор файла
                                        // this.files[0] = null;
                                        alert('Недопустимый файл типа! Выберите jpg,jpeg,png,gif,doc,docx,xls,xlsx,dot,xlst,txt,srv,reg или pdf.');
                                    } else {
                                        document.getElementById('uploadForm').submit(); // Отправляем форму, если файл правильного типа
                                    }
                                }
                            });
                        </script>
                        <!--                        const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif|\.txt|\.doc|\.docx|\.xls|\.xlsx|\.pdf|\.cer|\.vsdx|\.sql)$/i; // Задайте разрешенные типы файлов-->
                        <td><a th:href="@{/showbinstorage/{id}(id=${binstorage.id})}"
                               class="btn btn-outline-primary btn-sm">Изменить</a>
                            <a th:href="@{/deletebinstorage/{id}(id=${binstorage.id})}"
                               class="btn btn-outline-danger btn-sm">Удалить</a></td>
                    </tr>
                    </tbody>
                </table>
                <div class="container my-2" align="center" style="width:80%">
                    <span th:text="'Страница ' + ${currentPage} + ' из ' + ${totalPages}"></span>
                    <!-- Добавьте ссылки на навигацию между страницами -->
                    <nav align="center" aria-label="Page navigation">
                        <ul align="center" class="pagination">
                            <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{binstorage#(page=0)}">Первая</a>
                            </li>
                            <li class="page-item" th:classappend="${currentPage == 0 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{binstorage#(page=${currentPage - 1})}">Предыдущая</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                th:classappend="${currentPage == i ? 'active' : ''}">
                                <a class="page-link" th:href="@{binstorage#(page=${i})}" th:text="${i + 1}"></a>
                            </li>
                            <li class="page-item" th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{binstorage#(page=${currentPage + 1})}">Следующая</a>
                            </li>
                            <li class="page-item" th:classappend="${currentPage == totalPages - 1 ? 'disabled' : ''}">
                                <a class="page-link" th:href="@{binstorage#(page=${totalPages - 1})}">Последняя</a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- Bootstrap JS -->
                <script src="/bootstrap.bundle.min.js"></script>
            </div>
        </div>
    </div>
</div>

</body>
</html>